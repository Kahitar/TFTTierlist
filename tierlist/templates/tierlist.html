{% extends "layout.html" %}
{% block content %}
    <div class="container">
        <h1>Sologesang - Tierlist</h1>
        <div>Last update: {{ tierlist.last_updated.strftime('%d.%m.%Y') }}</div>
        <table class="table table-hover table-sm">
        <tbody>
            <tr class="table-active">
                <th style="width: 50px">RANKING</th>
                <th>CARRIES</th>
                <th>SYNERGIES</th>
                <th>CHOSEN</th>
                <th>ITEMS & POSITIONING</th>
                {% if current_user.is_authenticated and current_user.is_admin %}
                    <th class="text-center" colspan="2">Tier Up/Down</th>
                    <th class="text-center" colspan="2">Row Up/Down</th>
                    <th>Comp</th>
                {% endif %}
            </tr>
        	{% for comp in comps %}
                <tr>
                    <td class="tier-{{ comp.tier }}">Tier {{ comp.tier }}.{{ comp.sub_tier }}</td>
                    <td class="ml-2">{{ comp.carries }}</td>
                    <td class="ml-2">{{ comp.synergies }}</td>
                    <td class="ml-2">{{ comp.chosen }}</td>
                    <td class="ml-2"><a href="{{ comp.lolchess }}" target="_blank">lolchess.gg</a></td>

                    {% if current_user.is_authenticated and current_user.is_admin %}
                        <td>
                            {% if comp.tier > 1 or comp.sub_tier > 1 %}
                                <a class="btn btn-info btn-sm float-right" href="{{ url_for('comps.move_comp', comp_id=comp.id, direction='tier-up') }}">
                                    <img src="{{ url_for('static', filename='arrow-up-tier.ico') }}" alt="Tier up" class="">
                                </a>
                            {% endif %}
                        </td>
                        <td>
                            <a class="btn btn-info btn-sm" href="{{ url_for('comps.move_comp', comp_id=comp.id, direction='tier-down') }}">
                                <img src="{{ url_for('static', filename='arrow-down-tier.ico') }}" alt="Tier down" class="">
                            </a>
                        </td>
                        <td>
                            {% if comp.tier > 1 or comp.sub_tier > 1 %}
                                <a class="btn btn-info btn-sm float-right" href="{{ url_for('comps.move_comp', comp_id=comp.id, direction='up') }}">
                                    <img src="{{ url_for('static', filename='arrow-up-sub-tier.ico') }}" alt="Sub Tier up" class="">
                                </a>
                            {% endif %}
                        </td>
                        <td>
                            {% if comp != comps[-1] %}
                                <a class="btn btn-info btn-sm" href="{{ url_for('comps.move_comp', comp_id=comp.id, direction='down') }}">
                                    <img src="{{ url_for('static', filename='arrow-down-sub-tier.ico') }}" alt="Sub Tier down" class="">
                                </a>
                            {% endif %}
                        </td>
                        <td style="width: 130px">
                            <a class="btn btn-info btn-sm" href="{{ url_for('comps.update_comp', comp_id=comp.id) }}">Edit</a>
                            <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteModal{{ comp.id }}">Delete</button>
                        </td>
                    {% endif %}
                </tr>

                <!-- Modal from https://getbootstrap.com/docs/4.3/components/modal/#live-demo -->
                <div class="modal fade" id="deleteModal{{ comp.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Delete Comp? (Carries: {{ comp.carries }})</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <form action="{{ url_for('comps.delete_comp', comp_id=comp.id) }}" method="POST">
                            <input class="btn btn-danger" type="submit" value="Delete">
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
        	{% endfor %}
        </tbody>
        </table>
    </div>

    <div class="container ">
        {% for post in posts %}

            {% if loop.index % 2 == 1 %}
                <div class="row">
                    <div class="col-6">
            {% else %}
                    <div class="col-6">
            {% endif %}

            <article class="media content-section">
              <img class="rounded-circle article-img" src="{{ url_for('static', filename='profile_pics/' + post.author.image_file) }}"/>
              <div class="media-body">
                <div class="article-metadata">
                  <a class="mr-2" href="{{ url_for('users.user_posts', username=post.author.username) }}">{{ post.author.username }}</a>
                  <small class="text-muted">{{ post.date_posted.strftime('%d.%m.%Y %H:%M') }}</small>
                </div>
                <h2><a class="article-title" href="{{ url_for('posts.post', post_id=post.id) }}">{{ post.title }}</a></h2>

                {% if post.content|length > 200 %}
                    <p class="article-content">
                        {{ post.content[:200]|safe }}
                        <a class="text-muted" href="{{ url_for('posts.post', post_id=post.id) }}">[...] Read more...</a>
                    </p>
                {% else %}
                    <p class="article-content">{{ post.content|safe }}</p>
                {% endif %}
                {% if post.image_file %}
                    <img src="{{ url_for('static', filename='post_pics/' + post.image_file) }}" class="img-rounded img-fluid"/>
                {% endif %}
              </div>
            </article>

            {% if loop.index % 2 == 1 %}
                    </div>
            {% else %}
                    </div>
                </div>
            {% endif %}
            {% if loop.last and loop.index % 2 == 1 %}
                </div>
            {% endif %}

        {% endfor %}
    </div>

{% endblock content %}
