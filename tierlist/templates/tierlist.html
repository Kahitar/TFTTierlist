{% set max_tier = 5 %}

<div class="container-fluid">
    {% if current_user.is_authenticated and current_user == tierlist.author %}
        <div class="float-left mt-2 mb-2 mr-2">
            <a class="btn btn-sm btn-outline-info" href="{{ url_for('comps.new_comp', tierlist_id=tierlist.id) }}">Add Comp</a>
        </div>
        <div class="float-left mt-2 mb-2 mr-2">
            <a class="btn btn-sm btn-outline-info" href="{{ url_for('tierlists.tierlist_properties', tierlist_id=tierlist.id) }}">Options</a>
        </div>
    {% endif %}
    <div class="float-right mt-2">
        <div class="nav-item bg-warning">Last update: {{ tierlist.last_updated.strftime('%d.%m.%Y') }}</div>
    </div>
    <div class="table-responsive">
    <table class="table table-hover table-sm">
    <tbody>
        <tr class="table-active">
            <th style="width: 50px">RANKING</th>
            <th>CARRIES</th>
            <th>SYNERGIES</th>
            <th>ITEMS & POSITIONING</th>
            {% if current_user.is_authenticated and current_user == tierlist.author %}
                <th class="text-center" colspan="2">Tier Up/Down</th>
                <th class="text-center" colspan="2">Row Up/Down</th>
                <th>Comp</th>
            {% endif %}
        </tr>
    	{% for comp in comps %}
            <tr>
                {% if comp.tier == 6 %}
                    <td></td>
                {% else %}
                    <td class="tier-{{ comp.tier }}">Tier {{ comp.tier }}</td>
                {% endif %}
                <td class="ml-2">{{ comp.carries }}</td>
                <td class="ml-2">{{ comp.synergies }}</td>
                <td class="ml-2">{{ comp.lolchess|urlize(20, true, target="_blank") }}</td>

                {% if current_user.is_authenticated and current_user == tierlist.author %}
                    <td>
                        {% if comp.tier > 1 or comp.sub_tier > 1 %}
                            <a class="btn btn-info btn-sm float-right" href="{{ url_for('comps.move_comp', comp_id=comp.id, direction='tier-up') }}">
                                <img src="{{ url_for('static', filename='arrow-up-tier.ico') }}" alt="Tier up" class="">
                            </a>
                        {% endif %}
                    </td>
                    <td>
                        {% if comp.tier < (max_tier+1) %}
                            <a class="btn btn-info btn-sm" href="{{ url_for('comps.move_comp', comp_id=comp.id, direction='tier-down') }}">
                                <img src="{{ url_for('static', filename='arrow-down-tier.ico') }}" alt="Tier down" class="">
                            </a>
                        {% endif %}
                    </td>
                    <td>
                        {% if (comp.tier > 1 or comp.sub_tier > 1) and comp.tier < (max_tier+1) %}
                            <a class="btn btn-info btn-sm float-right" href="{{ url_for('comps.move_comp', comp_id=comp.id, direction='up') }}">
                                <img src="{{ url_for('static', filename='arrow-up-sub-tier.ico') }}" alt="Sub Tier up" class="">
                            </a>
                        {% endif %}
                    </td>
                    <td>
                        {% if comp != comps[-1] and comp.tier < (max_tier+1) %}
                            <a class="btn btn-info btn-sm" href="{{ url_for('comps.move_comp', comp_id=comp.id, direction='down') }}">
                                <img src="{{ url_for('static', filename='arrow-down-sub-tier.ico') }}" alt="Sub Tier down" class="">
                            </a>
                        {% endif %}
                    </td>
                    <td style="width: 130px">
                        <a class="btn btn-info btn-sm" href="{{ url_for('comps.update_comp', comp_id=comp.id) }}">Edit</a>
                        <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteCompModal{{ comp.id }}">Delete</button>
                    </td>
                {% endif %}
            </tr>

            <!-- Modal to delete comp (from https://getbootstrap.com/docs/4.3/components/modal/#live-demo) -->
            <div class="modal fade" id="deleteCompModal{{ comp.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteCompModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="deleteCompModalLabel">Delete Comp? (Carries: {{ comp.carries }})</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <form action="{{ url_for('comps.delete_comp', comp_id=comp.id) }}" method="POST">
                        <input class="btn btn-danger" type="submit" value="Delete">
                    </form>
                  </div>
                </div>
              </div>
            </div>
    	{% endfor %}
    </tbody>
    </table>
    </div>
</div>
